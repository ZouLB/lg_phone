"use strict";loader.define(["pages/common/common"],function(e,r,t,a){function o(){e.queryData("data",{},function(e,r){h.streetData=r.streetWorkIn,h.liveInWorkInTotal=r.liveInWorkInTotal,h.liveInWorkOutTotal=r.liveInWorkOutTotal,h.liveOutWorkInTotal=r.liveOutWorkInTotal}),e.queryData("work",{},function(e,r){h.lineData=r.city[0].rank,l(r),c(r),u(r)}),e.queryData("lg_geo",{},function(e,r){y=n(r.geoJson.features),echarts.registerMap("lg",r)}),e.queryData("sz_geo",{},function(e,r){d=v=n(r.geoJson.features),echarts.registerMap("sz",r),m(),f(h.curArea,h.direc)})}function n(e){var r={};return e.forEach(function(e){r[e.properties.name]=e.properties.cp}),r}function i(e){function r(e,r){return r[3]-e[3]}h.streetTotal=0;var t=h.streetData.filter(function(r){return 1==h.direc?e==r[0]:e==r[1]});return t.forEach(function(e){h.streetTotal+=parseInt(e[2])}),t.forEach(function(e){e[3]=(parseInt(e[2])/h.streetTotal*100).toFixed(2),e[4]=(1.3*parseInt(e[2])/1e4).toFixed(2)}),t.sort(r),t}function l(e){var e=e,r=(template("tpl-list",{listData:e.city}),template("ul-list",{lineData:h.lineData}));$("#list-wrap").html(r)}function c(e){$(".province").click(function(){if(h.direc=1,$(this).removeClass("primary-border").addClass("primary"),$(".outProvince").removeClass("primary").addClass("primary-border"),"sz"==h.curArea)s(e.city[0].rank,h.direc);else if("lg"==h.curArea){var r=i(h.curStreet);s(r,h.direc)}}),$(".outProvince").click(function(){if(h.direc=0,$(this).removeClass("primary-border").addClass("primary"),$(".province").removeClass("primary").addClass("primary-border"),"sz"==h.curArea)s(e.city[1].rank,h.direc);else if("lg"==h.curArea){var r=i(h.curStreet);s(r,h.direc)}})}function s(e,r){h.lineData=e,f(h.curArea,r)}function u(e){$(".father-nav").click(function(){$(this).addClass("item-nav-active").siblings().removeClass("item-nav-active"),h.curArea="sz",h.lineData=1==h.direc?e.city[0].rank:e.city[1].rank,d=v,f(h.curArea,h.direc)}),$(".child-nav").click(function(){$(this).addClass("item-nav-active").siblings().removeClass("item-nav-active"),h.curArea="lg",d=y,h.lineData=i(h.curStreet),f(h.curArea,h.direc)})}function m(){g=echarts.init(document.getElementById("chart"),"walden"),g.on("click",function(e){"sz"==h.curArea?"龙岗区"==e.name&&$(".child-nav").click():e.name&&(h.curStreet=e.name,h.lineData=i(e.name),f(h.curArea,h.direc))})}function f(e,r){var t=template("ul-list",{lineData:h.lineData});$("#list-wrap").html(t);var a=function(e){for(var r=[],t=0;t<e.length;t++){var a=e[t],o=d[a[0]],n=d[a[1]];o&&n&&r.push({fromName:a[0],toName:a[1],coords:[o,n]})}return r},o=h.lineData.map(function(e){return{name:e[r],value:parseFloat(e[3])}});"sz"==h.curArea&&o.push({name:"龙岗区"});var n=["#FB9F37"],i=[{type:"scatter",coordinateSystem:"geo"},{type:"map",geoIndex:0,data:o}];[["深圳",h.lineData]].forEach(function(e,t){i.push({type:"lines",zlevel:1,effect:{show:!0,period:2,trailLength:.3,color:n[t],symbolSize:3},lineStyle:{normal:{color:n[t],width:0,curveness:.2}},data:a(e[1])},{type:"lines",zlevel:2,symbolSize:10,lineStyle:{normal:{color:n[t],width:1,opacity:.6,curveness:.2}},data:a(e[1])},{type:"effectScatter",coordinateSystem:"geo",zlevel:2,rippleEffect:{brushType:"stroke"},label:{normal:{show:!0,position:"right",formatter:"{b}",color:n[t],fontSize:11}},symbolSize:function(e){return e[1]/8},itemStyle:{normal:{color:n[t]}},data:e[1].map(function(e){return{name:e[r],value:d[e[r]].concat([e[2]])}})})});var l={backgroundColor:"#F5F5F5",tooltip:{show:!1},visualMap:{min:0,max:h.lineData[0][3],show:!1,left:"left",top:"bottom",seriesIndex:[1],precision:2,inRange:{color:["rgb(156,199,244)","rgba(34,150,231, 1)"]}},geo:{map:e,zoom:1.2,label:{normal:{show:!1,textStyle:{color:"#333"}},emphasis:{show:!1}},roam:!1,itemStyle:{normal:{areaColor:"rgba(0,114,198,.9)",borderColor:"#fff"},emphasis:{areaColor:"rgba(0,114,198,.9)"}},regions:[{name:h.curStreet,itemStyle:{areaColor:"rgb(204,234,200)"},label:{show:!0,color:"#fff",fontSize:11}},{name:"龙岗区",itemStyle:{areaColor:"rgb(204,234,200)"},label:{show:!0,color:"#fff",fontSize:11}}]},series:i};g.setOption(l,!0),g.on("mouseover",function(e){g.dispatchAction({type:"downplay"})})}var p={};p.init=function(){o()};var d={},v={},y={},h={curArea:"sz",direc:1,lineData:[],curStreet:"龙城街道",streetData:[],liveInWorkInTotal:0,liveInWorkOutTotal:0,liveOutWorkInTotal:0},g=null;p.init(),a.exports=p});